### Д3 5 
### 5.1.1 _Terraform_
С помощью _terraform_ создать:
1. Изолированную частную сеть
2. Три сервера:
- _front_
   - 2 интерфейса: 1 – внешняя сеть, 2 – изолированная сеть,
   - ширина внешнего канала – 110 мбит/с,
- _back_ ( только интерфейс изолированной сети ),
- _db_ (только интерфейс изолированной сети ).

Подключение к созданным машинам сделать возможным только по ssh-ключу
На сервер _db_ должен быть дополнительный диск

Сформировать ansible-inventory с 3 группами: _front_, _back_ и _db_, где будут присутствовать созданные выше хосты

### 5.1.2 _Ansible_
Все имена пользователей, пароли и иная чувствительная информация должна храниться в ansible-vault

Написать плейбук с ролями на свой выбор

На всех хостах должны быть установлены и настроены (при необходимости) через роль/роли пакеты:
- chrony
- yum-utils
- mc
- curl
- htop
- atop
и удалены такие пакеты как AppArmor (в случае Debuntu), Cockpit

### 5.1.3
Все изменения должны быть реализованы только через плейбук

На хосте:

#### _back_
- установить _php-fpm_
- сконфигуировать возможность подключения к _php-fpm_ только с _localhost_ и с хоста _front_
- настроить фаерволл c правилами разрешения подключения к _php-fpm_ только с хоста _front_

#### _db_
- установить _mariadb_
- сконфигурировать _mariadb_:
   - разрешить подключение с хостов _front_ и _back_
   - задать пароль суперпользователя
   - исключить возможность использования пустого пароля для суперпользователя
   - создать БД для _Wordpress_
   - создать пользователя для _Wordpress_, задать пароль и наделить необходимыми правами
   - разрешить подключения пользователя для _Wordpress_ только с хоста _db_
   
#### _front_
- выступает в качестве интернет-шлюза для всех серверов изолированной сети – в результате с _db_ и _back_ должен быть доступ во внешний мир через этот хост
- установить _nginx_
- скачать и сконфигурировать _Wordpress_
- БД используется на хосте _db_
- PHP используется на хосте _back_

*Найти и исправить ошибки*

### _Часть 2_
Используем хосты из первой части
Обязательно использование хэндлеров

#### _front_
Конфигурация _chrony_ должна быть шаблонизирована

Для _nginx_ шаблонизировать конфигурационный файл
Все запросы для обработки _php_ должны уходить на сервер _back_
На хосте _front_ добавить модуль [vts](https://github.com/vozlt/nginx-module-vts)
В конфигурации выделить отдельный _location_ для отдачи статистики модуля _vts_

Добавить [vmagent](https://docs.victoriametrics.com/vmagent/) с шаблонизированной конфигурацией и описанным сервисом для systemd с возможностью запуска, останова и рестарта

Конфигурация _vmagent_ шаблонизирована, описывает сбор метрик модуля _vts_ и отправку в сервис _grafana_ на сервере _back_

#### _back_
Добавить _nginx_ на хост _back_, _php-fpm_ отдавать не напрямую через порт, а только через _nginx_
Конфигурационный файл должен быть шаблонизирован

Добавить роль _grafana_, которая деплоит два сервиса (как минимум) из _docker-compose.yaml_:
- influxdb
- grafana

_docker-compose.yaml_ - шаблонизирован
Доступ к веб-интерфейсу _grafana_ описать в конфигурации _nginx_ хостов _front_ и _back_

### _Часть 3_
На серверах _front_ и _db_ сконфигурировать _rsyslog_ на пересылку всех логов на хост _back_ при помощи _tcp_
Локально логи должны записываться как и раньше
В случае недоступности хоста _back_ неотправленные логи должны храниться до достижения отметки в 1 гигабайт суммарно в очереди.
Формат конфигурации _rsyslog_ - только [advanced](https://www.rsyslog.com/doc/configuration/conf_formats.html#which-format-should-i-use)